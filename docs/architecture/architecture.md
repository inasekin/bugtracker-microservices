# Архитектура

## Общая информация
TaskTracker — это система управления задачами, вдохновленная Jira и Redmine. Архитектура системы построена на основе микросервисов, которые взаимодействуют через API и message broker (RabbitMQ). Данные хранятся в PostgreSQL и MongoDB.

## Основные микросервисы
1. **User Service (Auth Service)** – управление пользователями и аутентификация.
2. **Project Service** – управление проектами.
3. **Task Service** – управление задачами (Issue).
4. **Comment Service** – система комментариев.
5. **Notification Service** – уведомления пользователей.
6. **File Storage Service** – хранение файлов.
7. **Integration Service** – интеграции с внешними системами (Telegram и т. д.).

## Взаимодействие между микросервисами
- **User Service** предоставляет данные о пользователях другим сервисам.
- **Project Service** использует User Service для проверки владельцев проектов.
- **Task Service** обращается к Project Service для проверки принадлежности задачи к проекту.
- **Comment Service** использует Task Service для проверки принадлежности комментария к задаче.
- **Notification Service** подписывается на события от других сервисов через RabbitMQ.
- **File Storage Service** позволяет загружать и привязывать файлы к задачам и комментариям.
- **Integration Service** работает с внешними API для отправки уведомлений и экспорта данных.

## API Методы

### User Service
#### `GET /api/user`
Возвращает список всех пользователей.

#### `GET /api/user/{id}`
Возвращает данные пользователя по ID.

#### `POST /api/user`
Создает нового пользователя.

#### `PUT /api/user/{id}`
Обновляет данные пользователя.

#### `DELETE /api/user/{id}`
Удаляет пользователя.

#### `POST /api/user/auth/register`
Регистрирует нового пользователя. После регистрации пользователь получает роль `guest`.

#### `POST /api/user/auth/login`
Авторизует пользователя и выдает JWT токен.

#### `POST /api/user/auth/logout`
Удаляет токен авторизации.

#### `GET /api/user/auth/current`
Получает текущего авторизованного пользователя по токену.

#### `POST /api/user/role/upgrade`
Позволяет пользователю стать `manager`. Доступно для администратора или через подтверждение приглашения.

### Project Service
Жизненный цикл проекта?

### Методы
#### `GET /api/project`
Возвращает список всех проектов (только для `manager` и `admin`).

#### `GET /api/project/user/{userId}`
Возвращает проекты, в которых участвует пользователь.

#### `GET /api/project/{id}`
Возвращает проект по ID.

#### `POST /api/project`
Создает новый проект (только для `manager` и `admin`). Пользователь `guest` не может создавать проекты.

#### `PUT /api/project/{id}`
Обновляет проект.

#### `DELETE /api/project/{id}`
Удаляет проект.

#### `POST /api/project/{id}/invite`
Приглашает пользователя в проект. Может использоваться для перевода `guest` в `manager`.

### Task Service
Жизненный цикл задачи?

### Методы
#### `GET /api/task`
Возвращает список всех задач.

#### `GET /api/task/user/{userId}`
Возвращает задачи, назначенные пользователю.

#### `GET /api/task/{id}`
Возвращает задачу по ID.

#### `POST /api/task`
Создает новую задачу (доступно `manager` и `admin`).

#### `PUT /api/task/{id}`
Обновляет задачу.

#### `DELETE /api/task/{id}`
Удаляет задачу.

### Comment Service
#### `GET /api/comment/task/{taskId}`
Возвращает все комментарии для задачи.

#### `POST /api/comment`
Создает комментарий к задаче.

#### `DELETE /api/comment/{id}`
Удаляет комментарий.

### Notification Service
#### `GET /api/notification/user/{userId}`
Возвращает уведомления пользователя.

#### `POST /api/notification`
Создает уведомление.

### File Storage Service
#### `POST /api/file/upload`
Загружает файл и привязывает его к задаче или комментарию.

#### `GET /api/file/{id}`
Возвращает ссылку на скачивание файла.

### Integration Service
Пока ничего

## Очереди сообщений (RabbitMQ)
- `user.created` – при создании пользователя отправляется событие.
- `task.created` – при создании задачи отправляется уведомление.
- `comment.added` – при добавлении комментария уведомляются подписчики задачи.

## CJM (Customer Journey Map)
### Роли пользователей
1. **Администратор** – полный доступ к системе, управление пользователями, проектами и настройками.
2. **Менеджер** – создание и управление проектами, назначение задач.
3. **Разработчик** – выполнение задач, комментирование, загрузка файлов.
4. **Гость** – просмотр задач и комментариев (ограниченный доступ). Может получить роль `manager` через приглашение в проект.

### Пути пользователей в системе
#### **Регистрация и авторизация**
1. Посещение страницы регистрации.
2. Ввод данных и отправка формы `POST /api/user/auth/register`. Роль `guest`.
3. Авторизация через `POST /api/user/auth/login`.
4. Доступ к личному кабинету через `GET /api/user/auth/current`.

#### **Переход из `guest` в `manager`**
1. Администратор или менеджер отправляет приглашение `POST /api/project/{id}/invite`.
2. Пользователь принимает приглашение, вызывая `POST /api/user/role/upgrade`.
3. Пользователь становится `manager` и может создавать проекты.

#### **Работа с проектами**
1. Просмотр своих проектов `GET /api/project/user/{userId}`.
2. Создание нового проекта `POST /api/project` (только `manager`, `admin`).

#### **Работа с задачами**
1. Просмотр задач, связанных с пользователем `GET /api/task/user/{userId}`
